
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéß RADIO CANNAFEST | En Vivo 24hs</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<link rel="icon" type="image/png" href="https://iili.io/fIqhMwQ.webp">
<link rel="apple-touch-icon" href="https://iili.io/fIqhMwQ.webp">
<meta name="theme-color" content="#00ff88">

<!-- SEO / OG -->
<meta name="description" content="Radio Cannafest en vivo 24hs. M√∫sica, cultura, pedidos musicales, difusi√≥n de emprendimientos y eventos.">
<meta property="og:type" content="website">
<meta property="og:title" content="RADIO CANNAFEST | En Vivo 24hs">
<meta property="og:description" content="M√∫sica, cultura, pedidos musicales y espacio publicitario para emprendimientos.">
<meta property="og:image" content="https://iili.io/fI0exVa.jpg">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">

<style>
@font-face {
  font-family: 'Cannabis';
  src: url('Cannabis.ttf') format('truetype');
  font-display: swap;
}

:root{
  --bg:#04110b;
  --card:rgba(0,0,0,.72);
  --card2:rgba(0,0,0,.62);
  --line:rgba(0,255,160,.22);
  --glow:0 0 18px rgba(0,255,150,.25);
  --txt:#d8fff0;
  --muted:#a7d8c8;
  --green:#00ff88;
  --green2:#00cc66;
  --cyan:#00d1ff;
  --pink:#ff00aa;
  --yellow:#ffe95b;
  --red:#ff3b5f;
  --radius:18px;
  --container:1080px;
}

*{margin:0;padding:0;box-sizing:border-box}
html,body{overflow-x:hidden}
body{
  font-family:'Poppins',sans-serif;
  background:
    radial-gradient(900px 500px at 10% -5%, rgba(0,255,136,.08), transparent 60%),
    radial-gradient(800px 400px at 90% 0%, rgba(0,209,255,.08), transparent 60%),
    url('https://iili.io/fzGgVlp.jpg') center/cover fixed no-repeat;
  color:var(--txt);
  text-align:center;
  padding:18px 12px 24px;
}
a{text-decoration:none;color:inherit}
img{max-width:100%;display:block}

.container{
  width:min(var(--container), calc(100% - 4px));
  margin-inline:auto;
}

.glass{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--glow);
  backdrop-filter:blur(8px);
}

.section{
  margin-top:18px;
  padding:16px;
  text-align:left;
}

.section h2{
  font-family:'Montserrat',sans-serif;
  font-size:1.15rem;
  color:#fff;
  margin-bottom:6px;
}
.section .section-sub{
  color:var(--muted);
  font-size:.92rem;
  line-height:1.45;
}

/* TOP INFO */
.top-info{
  max-width:680px;
  margin:0 auto 14px;
  padding:10px 14px;
  background:rgba(0,0,0,.55);
  border-radius:12px;
  border:1px solid rgba(0,255,136,.15);
  box-shadow:0 0 10px rgba(0,255,150,0.28);
}
.clima-line{font-size:.95rem;color:#00ff99;text-shadow:0 0 6px #00ff99;}
.hora-line{font-size:.88rem;color:#fff;opacity:.88}

/* HERO RADIO */
.radio-box{
  padding:22px 16px 18px;
  max-width:900px;
  margin:0 auto;
  border-radius:22px;
  background:rgba(0,0,0,.74);
  border:1px solid rgba(0,255,150,.18);
  box-shadow:0 0 24px rgba(0,255,150,.20);
}
.logo{
  width:260px;
  margin:0 auto 4px;
  display:block;
  animation:logoNeon 3s infinite ease-in-out;
}
@keyframes logoNeon{
  0%{filter:drop-shadow(0 0 10px #ffff33)}
  33%{filter:drop-shadow(0 0 12px #ff3333)}
  66%{filter:drop-shadow(0 0 12px #22ff22)}
  100%{filter:drop-shadow(0 0 10px #ffff33)}
}

.title{
  font-family:'Cannabis',sans-serif;
  font-size:2rem;
  font-weight:600;
  margin-top:2px;
  color:#00ffcc;
  text-shadow:0 0 12px #00ff88, 0 0 20px #00ffaa;
  line-height:1.08;
}

.marquee{
  width:100%;
  overflow:hidden;
  white-space:nowrap;
  margin-top:12px;
  font-size:1.02rem;
  font-weight:600;
  color:#00ff88;
  text-shadow:0 0 10px #00ff88;
}
.marquee span{
  display:inline-block;
  padding-left:100%;
  animation:scroll-left 13s linear infinite;
}
@keyframes scroll-left{
  0%{transform:translateX(0)}
  100%{transform:translateX(-100%)}
}

.en-vivo{
  display:inline-flex;align-items:center;gap:6px;
  background:rgba(255,0,0,.16);
  border:1px solid rgba(255,0,60,.55);
  padding:6px 14px;
  border-radius:999px;
  color:#ff5d78;
  font-weight:700;
  margin:10px auto 8px;
  box-shadow:0 0 10px rgba(255,0,60,.22);
}
.en-vivo .dot{
  width:10px;height:10px;border-radius:50%;background:#ff0033;
  animation:pulse 1s infinite;
}
@keyframes pulse{
  0%{transform:scale(.9);opacity:.6}
  50%{transform:scale(1.4);opacity:1}
  100%{transform:scale(.9);opacity:.6}
}

/* QUICK STATS */
.hero-mini-grid{
  display:grid;
  grid-template-columns:repeat(3,minmax(0,1fr));
  gap:10px;
  margin:12px 0 10px;
}
.mini-card{
  background:rgba(0,0,0,.42);
  border:1px solid rgba(255,255,255,.06);
  border-radius:14px;
  padding:10px;
  text-align:left;
}
.mini-label{
  color:var(--muted);
  font-size:.75rem;
  margin-bottom:4px;
}
.mini-value{
  color:#fff;
  font-weight:700;
  line-height:1.15;
  font-size:.95rem;
}
.oyentes-num{
  color:var(--green);
  text-shadow:0 0 10px rgba(0,255,136,.35);
  font-weight:700;
  font-size:1.1rem;
}

audio{width:100%;max-width:580px}

/* BUTTONS */
.btn-row{
  display:flex;flex-wrap:wrap;justify-content:center;gap:10px;
  margin-top:12px;
}
.btn{
  border:none;
  border-radius:999px;
  padding:12px 18px;
  font-weight:700;
  font-size:.98rem;
  cursor:pointer;
  transition:transform .16s ease, box-shadow .2s ease, opacity .2s ease;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}
.btn:hover{transform:translateY(-2px)}
.btn:active{transform:translateY(0)}
.play-btn{
  background:linear-gradient(135deg,var(--green),var(--green2));
  color:#001d10;
  box-shadow:0 0 14px rgba(0,255,136,.30);
}
.share-btn{
  background:linear-gradient(135deg,#00ccff,#0088ff);
  color:#fff;
  box-shadow:0 0 14px rgba(0,170,255,.28);
}
.btn-wa{
  background:linear-gradient(135deg,#2cf37b,#18bf5b);
  color:#062413;
  box-shadow:0 0 14px rgba(37,211,102,.28);
}
.btn-outline{
  background:rgba(255,255,255,.03);
  color:#fff;
  border:1px solid rgba(255,255,255,.14);
}
.btn-ig-icon{
  width:16px;
  height:16px;
  display:block;
  border-radius:4px;
}

#playerStatus{
  color:#fff;
  margin-top:10px;
  opacity:.9;
  font-size:.95rem;
}

/* INSTALL BTN */
#installBtn{
  background:#00ff88;
  color:#000;
  padding:11px 20px;
  border-radius:999px;
  font-size:1rem;
  border:none;
  margin-top:12px;
  cursor:pointer;
  display:none;
  box-shadow:0 0 12px #00ff88;
  font-weight:700;
}

/* FORM PEDI TU TEMA */
.request-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-top:12px;
}
.field{
  text-align:left;
}
.field label{
  display:block;
  color:#fff;
  font-size:.86rem;
  margin-bottom:6px;
}
.field input,.field textarea{
  width:100%;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.04);
  color:#fff;
  padding:12px;
  outline:none;
  font-family:inherit;
  font-size:.95rem;
}
.field input::placeholder,.field textarea::placeholder{color:rgba(255,255,255,.45)}
.field textarea{resize:vertical;min-height:100px}
.full{grid-column:1/-1}
.helper{
  margin-top:8px;
  color:var(--muted);
  font-size:.85rem;
  line-height:1.35;
}

/* ULTIMOS PEDIDOS */
.pedidos-list{
  margin-top:12px;
  display:grid;
  gap:8px;
}
.pedido-item{
  display:flex;
  justify-content:space-between;
  gap:10px;
  align-items:center;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.03);
  border-radius:12px;
  padding:10px 12px;
  opacity:0;
  transform:translateY(8px);
  animation:pedidoIn .35s ease forwards;
}
@keyframes pedidoIn{
  to{opacity:1;transform:translateY(0)}
}
.pedido-item .left{
  min-width:0;
}
.pedido-item strong{
  display:block;
  font-size:.92rem;
  color:#fff;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.pedido-item span{
  color:var(--muted);
  font-size:.82rem;
}
.badge-live{
  font-size:.73rem;
  color:#0f2;
  border:1px solid rgba(0,255,136,.22);
  background:rgba(0,255,136,.06);
  border-radius:999px;
  padding:4px 8px;
  white-space:nowrap;
}

/* PROGRAMACION / COMO PARTICIPAR / SOBRE */
.cards-3{
  display:grid;
  grid-template-columns:repeat(3,minmax(0,1fr));
  gap:12px;
  margin-top:12px;
}
.cards-4{
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:10px;
  margin-top:12px;
}
.info-card{
  border:1px solid rgba(255,255,255,.07);
  background:rgba(255,255,255,.03);
  border-radius:14px;
  padding:12px;
}
.info-card h3{
  font-size:.96rem;
  margin-bottom:6px;
  color:#fff;
}
.info-card p{
  color:var(--muted);
  line-height:1.4;
  font-size:.86rem;
}
.kpi{
  border:1px solid rgba(0,255,136,.15);
  background:rgba(0,255,136,.04);
  border-radius:14px;
  padding:12px;
  text-align:left;
}
.kpi strong{
  display:block;
  color:var(--green);
  font-size:1.1rem;
}
.kpi span{
  color:var(--muted);
  font-size:.82rem;
}

/* EVENTO DESTACADO */
.feature-event{
  margin-top:12px;
  display:grid;
  grid-template-columns:.95fr 1.05fr;
  gap:12px;
  align-items:stretch;
}
.feature-image{
  border-radius:16px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.08);
  background:#020202;
}
.feature-image img{
  width:100%;
  height:100%;
  object-fit:contain;
  background:#000;
}
.feature-body{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.03);
  border-radius:16px;
  padding:14px;
}
.feature-tag{
  display:inline-block;
  color:#111;
  background:linear-gradient(135deg,#ffe95b,#ffbf3b);
  border-radius:999px;
  padding:5px 10px;
  font-weight:700;
  font-size:.78rem;
  margin-bottom:10px;
}
.feature-body h3{
  color:#fff;
  font-size:1.02rem;
  line-height:1.2;
  margin-bottom:8px;
}
.feature-body p{
  color:var(--muted);
  line-height:1.45;
  font-size:.88rem;
  margin-bottom:8px;
}
.event-meta{
  display:grid;
  gap:6px;
  margin:10px 0 0;
}
.event-meta div{
  color:#dffef2;
  font-size:.86rem;
}

/* MARCAS CAROUSEL */
.brands-track{
  margin-top:12px;
  display:flex;
  gap:12px;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
  padding-bottom:4px;
}
.brands-track::-webkit-scrollbar{height:8px}
.brands-track::-webkit-scrollbar-thumb{
  background:rgba(255,255,255,.14);
  border-radius:999px;
}
.brand-card{
  min-width:min(310px, 88vw);
  scroll-snap-align:start;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.03);
  border-radius:16px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.brand-img{
  aspect-ratio:1.2/1;
  background:#060606;
  border-bottom:1px solid rgba(255,255,255,.06);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:8px;
}
.brand-img img{
  width:100%;
  height:100%;
  object-fit:contain;
}
.brand-body{
  padding:12px;
  display:grid;
  gap:6px;
}
.brand-body h3{
  font-size:1rem;
  color:#fff;
}
.brand-body p{
  color:var(--muted);
  font-size:.86rem;
  line-height:1.4;
}

/* Auto carrusel sponsors solo mobile */
@media (max-width: 680px){
  .brands-track.auto-scrolling{
    scroll-behavior: smooth;
  }
}

/* PAUTA */
.pauta-grid{
  margin-top:12px;
  display:grid;
  grid-template-columns:1.1fr .9fr;
  gap:12px;
}
.list{
  display:grid;
  gap:8px;
  margin-top:10px;
}
.list .li{
  border:1px solid rgba(255,255,255,.07);
  background:rgba(255,255,255,.03);
  border-radius:12px;
  padding:10px 12px;
  color:var(--txt);
  font-size:.9rem;
}
.price-box{
  border:1px dashed rgba(0,255,136,.28);
  background:rgba(0,255,136,.04);
  border-radius:14px;
  padding:12px;
}
.price-box h4{
  color:#fff;
  margin-bottom:6px;
}
.price-box p{
  color:var(--muted);
  line-height:1.45;
  font-size:.88rem;
}

/* INSTAGRAM */
.insta-box{
  padding:18px 16px;
  border-radius:20px;
  max-width:900px;
  background:rgba(0,0,0,.82);
  box-shadow:0 0 18px rgba(255,0,170,.22);
  border:1px solid rgba(255,0,170,.16);
  margin:18px auto 0;
  text-align:center;
}
.insta-title{
  font-size:1.35rem;
  color:#ff4fc4;
  margin-bottom:8px;
  font-family:'Montserrat',sans-serif;
}
.insta-link{
  color:#fff;
  text-decoration:none;
  font-size:1.05rem;
  display:inline-flex;
  align-items:center;
  gap:10px;
  justify-content:center;
}
.insta-logo{
  width:28px;
  filter:drop-shadow(0 0 8px #ff00aa);
}
.insta-sub{
  margin-top:8px;
  color:var(--muted);
  font-size:.9rem;
}

/* FOOTER */
.footer-ciborg{
  margin-top:20px;
  padding:12px 10px;
  background:rgba(0,0,0,.55);
  border-radius:12px;
  color:#00ffcc;
  font-weight:600;
  font-size:1rem;
  text-decoration:none;
  display:block;
  width:100%;
  max-width:900px;
  margin-left:auto;
  margin-right:auto;
  box-shadow:0 0 12px rgba(0,255,170,.22);
  border:1px solid rgba(0,255,170,.14);
}

/* FLOATING WAPP */
.floating-wa{
  position:fixed;
  right:12px;
  bottom:12px;
  z-index:50;
  width:56px;
  height:56px;
  border-radius:50%;
  display:grid;
  place-items:center;
  background:#25D366;
  box-shadow:0 10px 24px rgba(37,211,102,.35);
  border:1px solid rgba(255,255,255,.2);
  transition:bottom .22s ease, transform .18s ease;
}
.floating-wa.footer-safe{
  bottom:84px;
}
.floating-wa svg{width:28px;height:28px;fill:#fff;display:block}

/* RESPONSIVE */
@media (max-width:980px){
  .feature-event,
  .pauta-grid{grid-template-columns:1fr}
  .cards-3{grid-template-columns:1fr 1fr}
  .cards-4{grid-template-columns:1fr 1fr}
  .hero-mini-grid{grid-template-columns:1fr}
}
@media (max-width:680px){
  .request-grid{grid-template-columns:1fr}
  .cards-3,
  .cards-4{grid-template-columns:1fr}
  .logo{width:220px}
  .title{font-size:1.65rem}
  .pedido-item{align-items:flex-start;flex-direction:column}
  .btn-row .btn{width:100%}
  .radio-box{padding:18px 12px 16px}
  .section{padding:14px}
}
@media (min-width:1200px){
  .logo{width:300px}
  .title{font-size:2.25rem}
}
</style>
</head>

<body>

<!-- TOP INFO -->
<div class="top-info">
  <div class="clima-line" id="clima">Cargando clima...</div>
  <div class="hora-line" id="hora"></div>
  <div class="hora-line" id="fecha"></div>
</div>

<!-- HERO / RADIO -->
<div class="radio-box">
  <img src="https://iili.io/fIqhMwQ.webp" class="logo" alt="Logo Radio Cannafest">

  <h1 class="title">M√∫sica que fluye. Vibra que conecta.</h1>

  <div class="marquee">
    <span>üéß M√∫sica ‚Ä¢ Cultura ‚Ä¢ Comunidad ‚Ä¢ Ped√≠ tu tema por WhatsApp ‚Ä¢ Paut√° tu emprendimiento en Radio Cannafest üî¥üü°üü¢</span>
  </div>

  <div class="en-vivo"><div class="dot"></div> EN VIVO</div>

  <div class="hero-mini-grid">
    <div class="mini-card">
      <div class="mini-label">Oyentes en este momento</div>
      <div class="mini-value"><span class="oyentes-num" id="oyentesCount">248</span> oyentes</div>
    </div>

    <div class="mini-card">
      <div class="mini-label">Comunidad activa</div>
      <div class="mini-value">Pedidos musicales por WhatsApp</div>
      <div class="mini-label" style="margin-top:4px">Particip√° en vivo desde la web</div>
    </div>

    <div class="mini-card">
      <div class="mini-label">WhatsApp de la radio</div>
      <div class="mini-value" style="font-size:.9rem">Pedidos, pauta y difusi√≥n</div>
    </div>
  </div>

  <audio id="radioPlayer" preload="none" src="https://usa15.fastcast4u.com/proxy/ciborg347?mp=/1"></audio>

  <div class="btn-row">
    <button class="btn play-btn" id="playBtn" onclick="toggleRadio()">‚ñ∂ Escuchar radio</button>
    <button class="btn share-btn" onclick="shareRadio()">üì≤ Compartir radio</button>
    <a class="btn btn-wa" href="https://wa.me/message/KPWJHN63WA3MA1" target="_blank" rel="noopener noreferrer">üí¨ Ped√≠ tu tema</a>
    <a class="btn btn-outline" href="#pauta">üì£ Paut√° en la radio</a>
  </div>

  <div id="playerStatus">‚è∏ La radio est√° detenida.</div>

  <button id="installBtn">üì≤ Instalar Radio Cannafest</button>
</div>

<div class="container">

  <!-- PEDI TU TEMA -->
  <section class="section glass" id="pedi-tu-tema">
    <h2>Ped√≠ tu tema por WhatsApp</h2>
    <p class="section-sub">
      Dejanos tu nombre y tu n√∫mero para que te quede guardado en tu navegador y puedas pedir temas m√°s r√°pido la pr√≥xima vez.
    </p>

    <form id="temaForm" class="request-grid" novalidate>
      <div class="field">
        <label for="nombreOyente">Nombre</label>
        <input id="nombreOyente" type="text" placeholder="Ej: Mart√≠n" autocomplete="name">
      </div>
      <div class="field">
        <label for="numeroOyente">N√∫mero (opcional)</label>
        <input id="numeroOyente" type="tel" placeholder="Ej: 11 1234 5678" autocomplete="tel">
      </div>
      <div class="field full">
        <label for="pedidoTema">Pedido musical</label>
        <textarea id="pedidoTema" placeholder="Ej: Quiero pedir Los Cafres - Tus Ojos / saludo para..."></textarea>
      </div>
      <div class="field full">
        <button type="submit" class="btn btn-wa" style="width:100%;">Enviar pedido por WhatsApp</button>
        <div class="helper">
          Solo pedido musical por ahora (sin mensajes en vivo). Si recarg√°s la web, tus datos quedan guardados en este dispositivo.
        </div>
      </div>
    </form>
  </section>

  <!-- ULTIMOS PEDIDOS (ROTATIVOS) -->
  <section class="section glass" id="ultimos-pedidos">
    <h2>√öltimos pedidos musicales</h2>
    <p class="section-sub">Pedidos din√°micos de la comunidad que van cambiando autom√°ticamente para darle vida a la radio.</p>
    <div class="pedidos-list" id="pedidosList"></div>
  </section>

  <!-- COMO PARTICIPAR -->
  <section class="section glass" id="participar">
    <h2>C√≥mo participar</h2>
    <p class="section-sub">Simple, r√°pido y pensado para oyentes, feriantes y emprendimientos.</p>
    <div class="cards-3">
      <article class="info-card">
        <h3>1) Escuch√° la radio</h3>
        <p>Entr√°s, toc√°s ‚ÄúEscuchar radio‚Äù y te qued√°s en vivo mientras naveg√°s la web.</p>
      </article>
      <article class="info-card">
        <h3>2) Ped√≠ tu tema</h3>
        <p>Mand√°s tu pedido por WhatsApp con un texto prearmado. F√°cil desde celu o PC.</p>
      </article>
      <article class="info-card">
        <h3>3) Difund√≠ / paut√°</h3>
        <p>Si ten√©s marca, feria o evento, pod√©s sumar visibilidad con spot grabado y banner web.</p>
      </article>
    </div>
  </section>

  <!-- PROGRAMACION -->
  <section class="section glass" id="programacion">
    <h2>Programaci√≥n / Franjas musicales</h2>
    <p class="section-sub">Bloques de referencia para ordenar la experiencia de la radio y darle formato profesional.</p>
    <div class="cards-4">
      <article class="info-card">
        <h3>Ma√±ana</h3>
        <p>Vibra positiva, reggae roots, cl√°sicos y arranque tranqui para acompa√±ar el d√≠a.</p>
      </article>
      <article class="info-card">
        <h3>Tarde</h3>
        <p>Selecci√≥n din√°mica, novedades, mezcla de estilos y difusi√≥n de emprendimientos.</p>
      </article>
      <article class="info-card">
        <h3>Noche</h3>
        <p>Sets m√°s intensos, sesiones, especiales y clima ideal para quedarse conectado.</p>
      </article>
      <article class="info-card">
        <h3>Madrugada</h3>
        <p>Flujo continuo, selecci√≥n atmosf√©rica y m√∫sica para acompa√±ar hasta la ma√±ana.</p>
      </article>
    </div>
  </section>

  <!-- EVENTO DESTACADO -->
  <section class="section glass" id="evento-destacado">
    <h2>Evento destacado</h2>
    <p class="section-sub">Espacio principal para difusi√≥n de ferias, fechas y convocatorias de la comunidad.</p>

    <div class="feature-event">
      <div class="feature-image">
        <img src="https://iili.io/qKLurDF.jpg" alt="Jah Roots Sur Feria en Wilde">
      </div>

      <div class="feature-body">
        <span class="feature-tag">Destacado de la semana</span>
        <h3>JAH ROOTS SUR FERIA - Convocatoria a feriantes (Wilde)</h3>
        <p>
          Una fecha ideal para compartir, vender y conectar con la comunidad en Bar Mandr√°gora.
          Feria + artistas invitados + DJ en formato Sound System.
        </p>
        <div class="event-meta">
          <div>üìç Lugar: Bar Mandr√°gora - Wilde</div>
          <div>üìÖ Fecha: S√°bado 28 de febrero</div>
          <div>üõ† Armado: desde las 14 hs</div>
          <div>üõç Feria: de 15 a 21 hs</div>
          <div>üí∞ Stand: $15.000 (se puede compartir mesa)</div>
        </div>

        <div class="btn-row" style="justify-content:flex-start; margin-top:12px;">
          <a class="btn btn-outline" href="https://www.instagram.com/jahrootssur/" target="_blank" rel="noopener noreferrer">
            <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" class="btn-ig-icon" alt="">
            Ver Instagram de Jah Roots Sur
          </a>
          <a class="btn btn-wa" href="https://wa.me/message/KPWJHN63WA3MA1" target="_blank" rel="noopener noreferrer">üì£ Quiero difundir un evento</a>
        </div>
      </div>
    </div>
  </section>

  <!-- MARCAS QUE ACOMPA√ëAN -->
  <section class="section glass" id="marcas">
    <h2>Marcas que acompa√±an la radio</h2>
    <p class="section-sub">Espacio publicitario / vidriera para emprendimientos. Banner + perfil + difusi√≥n.</p>

    <div class="brands-track">

      <!-- CIBORG -->
      <article class="brand-card">
        <div class="brand-img">
          <img src="https://iili.io/qKLuPVa.jpg" alt="CIBORG 347">
        </div>
        <div class="brand-body">
          <h3>CIBORG 347 | Landing Pages & Designs</h3>
          <p>
            Dise√±o y desarrollo de sitios web simples y profesionales para emprendimientos, marcas, radios y negocios.
          </p>
          <div class="btn-row" style="justify-content:flex-start; margin-top:2px;">
            <a class="btn btn-outline" href="https://www.instagram.com/ciborg347" target="_blank" rel="noopener noreferrer">
              <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" class="btn-ig-icon" alt="">
              Ver Instagram
            </a>
          </div>
        </div>
      </article>

      <!-- MATU GRINDERS -->
      <article class="brand-card">
        <div class="brand-img">
          <img src="https://iili.io/qKLu6og.jpg" alt="Matu Grinders">
        </div>
        <div class="brand-body">
          <h3>Matu Grinders</h3>
          <p>
            Grinders y productos con impronta propia. Emprendimiento ideal para sumar visibilidad dentro de la comunidad.
          </p>
          <div class="btn-row" style="justify-content:flex-start; margin-top:2px;">
            <a class="btn btn-outline" href="https://www.instagram.com/matu_grinders?igsh=MWJrNHo1eHBybGp3cg==" target="_blank" rel="noopener noreferrer">
              <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" class="btn-ig-icon" alt="">
              Ver Instagram
            </a>
          </div>
        </div>
      </article>

      <!-- JAH ROOTS SUR -->
      <article class="brand-card">
        <div class="brand-img">
          <img src="https://iili.io/qKLurDF.jpg" alt="Jah Roots Sur">
        </div>
        <div class="brand-body">
          <h3>Jah Roots Sur</h3>
          <p>
            Comunidad, ferias y movidas culturales. Difusi√≥n de convocatorias y eventos con enfoque local y colaborativo.
          </p>
          <div class="btn-row" style="justify-content:flex-start; margin-top:2px;">
            <a class="btn btn-outline" href="https://www.instagram.com/jahrootssur/" target="_blank" rel="noopener noreferrer">
              <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" class="btn-ig-icon" alt="">
              Ver Instagram
            </a>
          </div>
        </div>
      </article>

    </div>
  </section>

  <!-- PAUTA -->
  <section class="section glass" id="pauta">
    <h2>Paut√° en Radio Cannafest</h2>
    <p class="section-sub">
      Sum√° visibilidad para tu emprendimiento, feria, servicio o evento con difusi√≥n en la web y posibilidad de spot grabado.
    </p>

    <div class="pauta-grid">
      <div class="info-card">
        <h3>Opciones de difusi√≥n</h3>
        <div class="list">
          <div class="li">üìå Banner / card en la web (secci√≥n de marcas que acompa√±an)</div>
          <div class="li">üéô Spot grabado para pasar en la radio</div>
          <div class="li">üì£ Difusi√≥n de eventos / convocatorias</div>
          <div class="li">üîó Enlace directo a Instagram / contacto</div>
          <div class="li">ü§ù Combos con dise√±o web / landing (CIBORG 347)</div>
        </div>

        <div class="btn-row" style="justify-content:flex-start; margin-top:12px;">
          <a class="btn btn-wa" href="https://wa.me/message/KPWJHN63WA3MA1" target="_blank" rel="noopener noreferrer">Comunicaci√≥n / pauta por WhatsApp</a>
        </div>
      </div>

      <div class="info-card">
        <h3>Ideal para</h3>
        <div class="list">
          <div class="li">Ferias y convocatorias</div>
          <div class="li">Emprendimientos locales</div>
          <div class="li">Servicios y oficios</div>
          <div class="li">Bandas / artistas / fechas</div>
          <div class="li">Marcas que quieren comunidad + alcance</div>
        </div>

        <div class="price-box" style="margin-top:12px;">
          <h4>¬øQuer√©s aparecer ac√°?</h4>
          <p>
            Escribinos y contanos qu√© quer√©s promocionar. Te armamos una propuesta de difusi√≥n seg√∫n tu objetivo.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- SOBRE LA RADIO -->
  <section class="section glass" id="sobre-radio">
    <h2>Sobre Radio Cannafest</h2>
    <p class="section-sub">
      Radio Cannafest es un espacio de m√∫sica, cultura y comunidad. Adem√°s de la transmisi√≥n en vivo, funciona como vidriera para emprendimientos y difusi√≥n de eventos.
    </p>
    <div class="cards-3">
      <div class="kpi">
        <strong>M√∫sica + comunidad</strong>
        <span>Una web pensada para escuchar, participar y conectar.</span>
      </div>
      <div class="kpi">
        <strong>Difusi√≥n real</strong>
        <span>Eventos, marcas y proyectos con presencia en web + radio.</span>
      </div>
      <div class="kpi">
        <strong>Pedidos por WhatsApp</strong>
        <span>Canal directo para oyentes y consultas comerciales.</span>
      </div>
    </div>
  </section>

</div>

<!-- INSTAGRAM -->
<div class="insta-box">
  <h2 class="insta-title">Instagram Oficial</h2>
  <a href="https://www.instagram.com/cannafest2025" target="_blank" class="insta-link" rel="noopener noreferrer">
    <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" class="insta-logo" alt="Instagram">
    @cannafest2025
  </a>
  <div class="insta-sub">Seguinos para novedades, contenido, difusi√≥n y movimientos de la comunidad.</div>
</div>

<!-- FOOTER -->
<a class="footer-ciborg" href="https://ciborg347.onrender.com" target="_blank" rel="noopener noreferrer">
  Creado y dise√±ado por Ciborg 347
</a>

<!-- FLOATING WHATSAPP -->
<a class="floating-wa" href="https://wa.me/message/KPWJHN63WA3MA1" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp de la radio">
  <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M20.52 3.48A11.86 11.86 0 0 0 12.07 0C5.47 0 .09 5.36.09 11.96c0 2.11.55 4.18 1.6 6.01L0 24l6.2-1.62a11.92 11.92 0 0 0 5.87 1.5h.01c6.59 0 11.97-5.36 11.97-11.96c0-3.2-1.25-6.2-3.53-8.44ZM12.08 21.86h-.01a9.9 9.9 0 0 1-5.04-1.38l-.36-.21-3.68.96.98-3.59-.23-.37a9.9 9.9 0 0 1-1.53-5.31c0-5.48 4.46-9.94 9.95-9.94c2.66 0 5.15 1.03 7.03 2.9a9.85 9.85 0 0 1 2.92 7.03c0 5.48-4.47 9.94-9.95 9.94Zm5.45-7.42c-.3-.15-1.79-.88-2.07-.98c-.28-.1-.48-.15-.68.15c-.2.3-.78.98-.95 1.18c-.18.2-.35.23-.65.08c-.3-.15-1.25-.46-2.39-1.47c-.89-.79-1.49-1.76-1.66-2.06c-.18-.3-.02-.46.13-.61c.14-.14.3-.35.45-.53c.15-.18.2-.3.3-.5c.1-.2.05-.38-.03-.53c-.08-.15-.68-1.65-.93-2.25c-.25-.61-.5-.52-.68-.53h-.58c-.2 0-.53.08-.8.38c-.28.3-1.05 1.03-1.05 2.51s1.08 2.92 1.23 3.12c.15.2 2.12 3.24 5.13 4.54c.72.31 1.28.49 1.72.62c.72.23 1.38.2 1.9.12c.58-.09 1.79-.73 2.05-1.44c.25-.71.25-1.31.18-1.44c-.08-.13-.28-.2-.58-.35Z"/></svg>
</a>

<script>
/* SERVICE WORKER / PWA */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/service-worker.js").catch(() => {});
}

/* INSTALL PROMPT */
let deferredPrompt;
const installBtn = document.getElementById("installBtn");

window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = "inline-block";
});

installBtn.addEventListener("click", async () => {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  try { await deferredPrompt.userChoice; } catch(e){}
  deferredPrompt = null;
  installBtn.style.display = "none";
});

/* RADIO PLAYER */
const audio = document.getElementById("radioPlayer");
const btn = document.getElementById("playBtn");
const statusEl = document.getElementById("playerStatus");
let playing = false;

function toggleRadio(){
  if(!playing){
    audio.load();
    audio.play().then(()=>{
      playing = true;
      btn.textContent = "‚è∏ Detener radio";
      statusEl.textContent = "üéß Reproduciendo en vivo...";
    }).catch(()=>{
      statusEl.textContent = "‚ö† Toc√° nuevamente para iniciar la radio";
    });
  } else {
    audio.pause();
    playing = false;
    btn.textContent = "‚ñ∂ Escuchar radio";
    statusEl.textContent = "‚è∏ La radio est√° detenida.";
  }
}

function shareRadio(){
  const text = "üéß Escuch√° Radio Cannafest: m√∫sica, difusi√≥n y buena onda!";
  const url = "https://radio-cannafest.onrender.com";
  if(navigator.share){
    navigator.share({title:"Radio Cannafest", text, url}).catch(()=>{});
  } else {
    alert("Copi√° y compart√≠:\n" + text + "\n" + url);
  }
}

/* HORA / FECHA */
function actHora(){
  const n = new Date();
  document.getElementById("hora").textContent = n.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit",second:"2-digit"});
  document.getElementById("fecha").textContent = n.toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long"});
}
setInterval(actHora,1000);
actHora();

/* CLIMA */
async function cargarClima(){
  try{
    const ip = await fetch("https://ipapi.co/json/").then(r=>r.json());
    const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${ip.latitude}&longitude=${ip.longitude}&current_weather=true`).then(x=>x.json());
    const t = r.current_weather.temperature;
    const c = r.current_weather.weathercode;

    let icon = "‚òÄÔ∏è", est = "Despejado";
    if(c>=1 && c<=3){icon="‚õÖ";est="Parcialmente nublado";}
    if(c>=45&&c<=48){icon="üå´Ô∏è";est="Niebla";}
    if(c>=51&&c<=57){icon="üå¶Ô∏è";est="Llovizna";}
    if(c>=61&&c<=67){icon="üåßÔ∏è";est="Lluvia";}
    if(c>=71&&c<=77){icon="‚ùÑÔ∏è";est="Nieve";}
    if(c>=80&&c<=82){icon="üåßÔ∏è";est="Chaparrones";}
    if(c>=95){icon="‚õàÔ∏è";est="Tormenta";}

    document.getElementById("clima").textContent = `${icon} ${ip.city} - ${t}¬∞C - ${est}`;
  }catch{
    document.getElementById("clima").textContent = "Clima no disponible";
  }
}
cargarClima();

/* OYENTES DINAMICOS (SUAVE + PERSISTENTE) */
const oyentesEl = document.getElementById("oyentesCount");
const OYENTES_KEY = "radio_cannafest_oyentes_v2";

function getTargetRangeByHour(hour){
  if(hour >= 0 && hour < 3) return {min:95, max:180};
  if(hour >= 3 && hour < 6) return {min:50, max:130};
  if(hour >= 6 && hour < 10) return {min:140, max:240};
  if(hour >= 10 && hour < 14) return {min:180, max:290};
  if(hour >= 14 && hour < 18) return {min:170, max:280};
  if(hour >= 18 && hour < 22) return {min:220, max:373};
  return {min:190, max:340};
}

function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

function initOyentes(){
  const now = Date.now();
  const hour = new Date().getHours();
  const range = getTargetRangeByHour(hour);

  let state;
  try { state = JSON.parse(localStorage.getItem(OYENTES_KEY) || "null"); } catch(e){ state = null; }

  if(!state || typeof state.value !== "number"){
    state = { value: Math.floor((range.min + range.max) / 2), ts: now };
    localStorage.setItem(OYENTES_KEY, JSON.stringify(state));
  }

  const elapsedMin = Math.floor((now - (state.ts || now)) / 60000);
  let value = clamp(Math.round(state.value), 50, 373);

  if(elapsedMin > 0){
    for(let i=0; i<Math.min(elapsedMin, 240); i++){
      value = nextOyentesValue(value, new Date((state.ts||now) + (i+1)*60000));
    }
    state = { value, ts: now };
    localStorage.setItem(OYENTES_KEY, JSON.stringify(state));
  }

  oyentesEl.textContent = value;
  return state;
}

function nextOyentesValue(current, dateObj){
  const hour = dateObj.getHours();
  const range = getTargetRangeByHour(hour);
  const mid = (range.min + range.max) / 2;

  const stepMax = (hour >= 18 && hour < 22) ? 4 : 3;
  let step = Math.floor(Math.random() * (stepMax * 2 + 1)) - stepMax;

  if(current < range.min + 8) step = Math.max(step, 1);
  if(current > range.max - 8) step = Math.min(step, -1);

  if(current < mid - 25 && Math.random() < 0.55) step += 1;
  if(current > mid + 25 && Math.random() < 0.55) step -= 1;

  if(step === 0 && Math.random() < 0.35) step = current < mid ? 1 : -1;

  return clamp(current + step, 50, 373);
}

function tickOyentes(){
  let state;
  try { state = JSON.parse(localStorage.getItem(OYENTES_KEY) || "null"); } catch(e){ state = null; }
  const now = Date.now();
  let current = state && typeof state.value === "number" ? state.value : 220;
  const next = nextOyentesValue(current, new Date(now));
  const newState = { value: next, ts: now };
  localStorage.setItem(OYENTES_KEY, JSON.stringify(newState));
  oyentesEl.textContent = next;
}
initOyentes();
setInterval(tickOyentes, 9000);

/* PEDIDOS MUSICALES ROTATIVOS (SOLO 3 Y MEZCLADOS) */
const pedidosData = [
  {n:"Leo", z:"Wilde", t:"Los Cafres - Tus Ojos"},
  {n:"Mica", z:"Quilmes", t:"Bob Marley - Is This Love"},
  {n:"Nico", z:"San Miguel", t:"Dread Mar I - Tu Sin Mi"},
  {n:"Cami", z:"Avellaneda", t:"Zona Ganjah - Quiero Volar"},
  {n:"Tomi", z:"Pilar", t:"Nonpalidece - La Flor"},
  {n:"Rocio", z:"Mor√≥n", t:"Alborosie - Kingston Town"},
  {n:"Bruno", z:"Lomas", t:"Gondwana - Sentimiento Original"},
  {n:"Sofi", z:"Lan√∫s", t:"Los Pericos - Pupilas Lejanas"},
  {n:"Axel", z:"Ituzaing√≥", t:"Kameleba - Todo Va A Estar Bien"},
  {n:"Noe", z:"Wilde", t:"Fidel Nadal - International Love"},
  {n:"Mati", z:"Haedo", t:"Damian Marley - Welcome To Jamrock"},
  {n:"Luz", z:"Longchamps", t:"Cultura Prof√©tica - Ilegal"},
  {n:"Joa", z:"Jos√© C. Paz", t:"Morodo - La Yerba Del Rey"},
  {n:"Mar", z:"Hurlingham", t:"Riddim - Hablame"},
  {n:"Franco", z:"San Justo", t:"Resistencia Suburbana - Jah Gu√≠a"},
  {n:"Ana", z:"Berazategui", t:"Protoje - Who Knows"},
  {n:"Pablo", z:"Merlo", t:"Alika - No Dejes Que Te Paren"},
  {n:"Delfi", z:"Tigre", t:"Los Cafres - Casi Q Te Envidio"},
  {n:"Mauro", z:"Ramos Mej√≠a", t:"Nonpalidece - Dame Luz"},
  {n:"Vero", z:"Escobar", t:"Gondwana - Armon√≠a De Amor"},
  {n:"Gonza", z:"San Fernando", t:"Dread Mar I - Hoja En Blanco"},
  {n:"Julieta", z:"Adrogu√©", t:"Kafu Banton - Caminando"},
  {n:"Eze", z:"Bella Vista", t:"Los Pericos - Me Late"},
  {n:"Yami", z:"Wilde", t:"Bob Marley - Could You Be Loved"},
  {n:"Fede", z:"Banfield", t:"Zona Ganjah - Despertar"},
  {n:"Ari", z:"Malvinas", t:"Kameleba - Pulso"},
  {n:"Valen", z:"Vicente L√≥pez", t:"Cultura Prof√©tica - Para Estar"},
  {n:"Nacho", z:"Mart√≠nez", t:"Morodo - Divina Ciencia"},
  {n:"Meli", z:"Ezeiza", t:"Dread Mar I - As√≠ Fue"},
  {n:"Gabi", z:"Burzaco", t:"Resistencia Suburbana - Rastaman"},
  {n:"Juan", z:"Moreno", t:"Nonpalidece - Mi Fortaleza"},
  {n:"Ceci", z:"Florencio Varela", t:"Los Cafres - Bastar√°"},
  {n:"Alan", z:"Wilde", t:"Gondwana - Verde Amarillo y Rojo"},
  {n:"Karen", z:"Pacheco", t:"Alborosie - Herbalist"},
  {n:"Santi", z:"San Mart√≠n", t:"Fidel Nadal - Te Robaste Mi Coraz√≥n"},
  {n:"Nahir", z:"Don Torcuato", t:"Protoje - Kingston Be Wise"},
  {n:"Lauti", z:"Paso del Rey", t:"Riddim - Aire"},
  {n:"Agus", z:"Padua", t:"Damian Marley - Road To Zion"},
  {n:"Flor", z:"Monte Grande", t:"Kafu Banton - Vamos Pa la Playa"},
  {n:"Ivana", z:"Wilde", t:"Los Pericos - Waitin"},
  {n:"Bauti", z:"Mu√±iz", t:"Kameleba - Irie"},
  {n:"Carla", z:"Campana", t:"Zona Ganjah - Vibra Positiva"},
  {n:"Dani", z:"Laferrere", t:"Dread Mar I - Nada"},
  {n:"Micaela", z:"Temperley", t:"Gondwana - Felicidad"},
  {n:"Hern√°n", z:"Caseros", t:"Nonpalidece - Reggae En El Universo"},
  {n:"Bianca", z:"Merlo", t:"Los Cafres - Si El Amor Se Cae"},
  {n:"Facu", z:"Quilmes", t:"Morodo - Burnin"},
  {n:"Nati", z:"Pilar", t:"Cultura Prof√©tica - Saca Prende y Sorprende"},
  {n:"Thiago", z:"San Miguel", t:"Bob Marley - Three Little Birds"},
  {n:"Paula", z:"Wilde", t:"Dread Mar I - No Corresponde"}
];

const pedidosList = document.getElementById("pedidosList");
let pedidosActuales = [];

function shuffleArray(arr){
  const a = arr.slice();
  for(let i = a.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function pick3Mixed(){
  let pool = shuffleArray(pedidosData);
  let selected = [];

  for(let i=0; i<pool.length && selected.length<3; i++){
    const item = pool[i];
    const repeated = pedidosActuales.some(p => p.n === item.n && p.t === item.t);
    if(!repeated) selected.push(item);
  }

  if(selected.length < 3){
    pool = shuffleArray(pedidosData);
    for(let i=0; i<pool.length && selected.length<3; i++){
      const item = pool[i];
      const exists = selected.some(s => s.n === item.n && s.t === item.t);
      if(!exists) selected.push(item);
    }
  }

  return selected;
}

function renderPedidosBlock(){
  if(!pedidosList) return;

  pedidosActuales = pick3Mixed();
  pedidosList.innerHTML = "";

  pedidosActuales.forEach((item, idx) => {
    const row = document.createElement("div");
    row.className = "pedido-item";
    row.style.animationDelay = `${idx * 0.06}s`;
    row.innerHTML = `
      <div class="left">
        <strong>${item.n} de ${item.z}</strong>
        <span>Pidi√≥: ${item.t}</span>
      </div>
      <div class="badge-live">Pedido musical</div>
    `;
    pedidosList.appendChild(row);
  });
}
renderPedidosBlock();
setInterval(renderPedidosBlock, 9000);

/* FORM PEDI TU TEMA + LOCALSTORAGE */
const temaForm = document.getElementById("temaForm");
const nombreOyente = document.getElementById("nombreOyente");
const numeroOyente = document.getElementById("numeroOyente");
const pedidoTema = document.getElementById("pedidoTema");

const FORM_KEY = "radio_cannafest_pedido_form_v1";

(function loadSavedForm(){
  try{
    const data = JSON.parse(localStorage.getItem(FORM_KEY) || "{}");
    if(data.nombre) nombreOyente.value = data.nombre;
    if(data.numero) numeroOyente.value = data.numero;
  }catch(e){}
})();

function saveFormLocal(){
  const data = {
    nombre: (nombreOyente.value || "").trim(),
    numero: (numeroOyente.value || "").trim()
  };
  localStorage.setItem(FORM_KEY, JSON.stringify(data));
}

[nombreOyente, numeroOyente].forEach(el => {
  el.addEventListener("input", saveFormLocal);
  el.addEventListener("change", saveFormLocal);
});

temaForm.addEventListener("submit", function(e){
  e.preventDefault();
  saveFormLocal();

  const nombre = (nombreOyente.value || "").trim();
  const numero = (numeroOyente.value || "").trim();
  const pedido = (pedidoTema.value || "").trim();

  if(!pedido){
    pedidoTema.focus();
    alert("Escrib√≠ el pedido musical antes de enviar.");
    return;
  }

  const partes = [];
  partes.push("Hola Radio Cannafest! Quiero pedir un tema.");
  if(nombre) partes.push(`Nombre: ${nombre}`);
  if(numero) partes.push(`Numero: ${numero}`);
  partes.push(`Pedido: ${pedido}`);
  partes.push("Gracias! (Pedido musical desde la web)");

  const texto = encodeURIComponent(partes.join("\n"));
  const waUrl = `https://wa.me/message/KPWJHN63WA3MA1?text=${texto}`;

  window.open(waUrl, "_blank", "noopener,noreferrer");
});

/* CARRUSEL SPONSORS AUTO (solo mobile, recorre TODAS las tarjetas y recien vuelve) */
(function initSponsorsAutoCarousel(){
  const track = document.querySelector(".brands-track");
  if(!track) return;

  let autoTimer = null;
  let resumeTimer = null;
  let isUserInteracting = false;
  let currentIndex = 0;
  let totalCards = 0;

  function isMobile(){
    return window.matchMedia("(max-width: 680px)").matches;
  }

  function cards(){
    return Array.from(track.querySelectorAll(".brand-card"));
  }

  function refreshMetrics(){
    totalCards = cards().length;
  }

  function scrollToIndex(index){
    const list = cards();
    if(!list.length) return;
    const safeIndex = Math.max(0, Math.min(index, list.length - 1));
    const card = list[safeIndex];
    track.scrollTo({ left: card.offsetLeft, behavior: "smooth" });
    currentIndex = safeIndex;
  }

  function nextSlide(){
    if(!isMobile() || isUserInteracting) return;

    refreshMetrics();
    if(totalCards <= 1) return;

    if(currentIndex < totalCards - 1){
      scrollToIndex(currentIndex + 1);
    } else {
      stopAuto();
      setTimeout(() => {
        if(!isMobile() || isUserInteracting) return;
        scrollToIndex(0);
        setTimeout(() => {
          if(!isMobile() || isUserInteracting) return;
          startAuto();
        }, 900);
      }, 1200);
    }
  }

  function startAuto(){
    stopAuto();
    if(!isMobile()) return;

    track.classList.add("auto-scrolling");
    refreshMetrics();

    const list = cards();
    if(list.length){
      let nearest = 0;
      let minDist = Infinity;
      const left = track.scrollLeft;
      list.forEach((card, i) => {
        const d = Math.abs(card.offsetLeft - left);
        if(d < minDist){ minDist = d; nearest = i; }
      });
      currentIndex = nearest;
    }

    autoTimer = setInterval(nextSlide, 1700);
  }

  function stopAuto(){
    if(autoTimer){
      clearInterval(autoTimer);
      autoTimer = null;
    }
  }

  function pauseAndResume(){
    isUserInteracting = true;
    stopAuto();
    if(resumeTimer) clearTimeout(resumeTimer);

    const list = cards();
    if(list.length){
      let nearest = 0;
      let minDist = Infinity;
      const left = track.scrollLeft;
      list.forEach((card, i) => {
        const d = Math.abs(card.offsetLeft - left);
        if(d < minDist){ minDist = d; nearest = i; }
      });
      currentIndex = nearest;
    }

    resumeTimer = setTimeout(() => {
      isUserInteracting = false;
      startAuto();
    }, 3200);
  }

  ["touchstart","pointerdown","mousedown","wheel"].forEach(evt => {
    track.addEventListener(evt, pauseAndResume, { passive: true });
  });

  ["touchend","pointerup","mouseup"].forEach(evt => {
    track.addEventListener(evt, pauseAndResume, { passive: true });
  });

  window.addEventListener("resize", () => {
    if(resumeTimer) clearTimeout(resumeTimer);
    isUserInteracting = false;
    refreshMetrics();
    startAuto();
  });

  document.addEventListener("visibilitychange", () => {
    if(document.hidden){
      stopAuto();
    } else {
      startAuto();
    }
  });

  refreshMetrics();
  startAuto();
})();

/* BOTON WHATSAPP NO TAPA FOOTER */
(function waNoTapeFooter(){
  const waBtn = document.querySelector(".floating-wa");
  const footer = document.querySelector(".footer-ciborg");
  if(!waBtn || !footer) return;

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if(entry.isIntersecting){
        waBtn.classList.add("footer-safe");
      } else {
        waBtn.classList.remove("footer-safe");
      }
    });
  }, {
    root: null,
    threshold: 0.15
  });

  observer.observe(footer);
})();
</script>

</body>
</html>
