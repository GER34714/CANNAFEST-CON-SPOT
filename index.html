<!-- 2) AGREGA este JS al final de tu <script> principal (debajo de renderPedidos/form, antes de cerrar </script>) -->
<script>
/* CARRUSEL SPONSORS AUTO (solo mobile) */
(function initSponsorsAutoCarousel(){
  const track = document.querySelector(".brands-track");
  if(!track) return;

  let autoTimer = null;
  let resumeTimer = null;
  let isUserInteracting = false;

  function isMobile(){
    return window.matchMedia("(max-width: 680px)").matches;
  }

  function getStep(){
    const firstCard = track.querySelector(".brand-card");
    if(!firstCard) return Math.floor(track.clientWidth * 0.9);
    const styles = getComputedStyle(track);
    const gap = parseFloat(styles.columnGap || styles.gap || 12) || 12;
    return Math.round(firstCard.getBoundingClientRect().width + gap);
  }

  function maxScroll(){
    return track.scrollWidth - track.clientWidth;
  }

  function nextSlide(){
    if(!isMobile() || isUserInteracting) return;

    const step = getStep();
    const end = maxScroll();
    const next = track.scrollLeft + step;

    if(next >= end - 8){
      track.scrollTo({ left: 0, behavior: "smooth" });
    } else {
      track.scrollTo({ left: next, behavior: "smooth" });
    }
  }

  function startAuto(){
    stopAuto();
    if(!isMobile()) return;
    track.classList.add("auto-scrolling");
    autoTimer = setInterval(nextSlide, 2800);
  }

  function stopAuto(){
    if(autoTimer){
      clearInterval(autoTimer);
      autoTimer = null;
    }
  }

  function pauseAndResume(){
    isUserInteracting = true;
    stopAuto();
    if(resumeTimer) clearTimeout(resumeTimer);
    resumeTimer = setTimeout(() => {
      isUserInteracting = false;
      startAuto();
    }, 3500);
  }

  /* Pausa cuando interactúan */
  ["touchstart","pointerdown","mousedown","wheel"].forEach(evt => {
    track.addEventListener(evt, pauseAndResume, { passive: true });
  });

  ["touchend","pointerup","mouseup"].forEach(evt => {
    track.addEventListener(evt, pauseAndResume, { passive: true });
  });

  /* Reinicia si cambia tamaño/orientación */
  window.addEventListener("resize", () => {
    if(resumeTimer) clearTimeout(resumeTimer);
    isUserInteracting = false;
    startAuto();
  });

  document.addEventListener("visibilitychange", () => {
    if(document.hidden){
      stopAuto();
    } else {
      startAuto();
    }
  });

  startAuto();
})();
</script>
